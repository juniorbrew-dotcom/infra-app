<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Gestão de Infraestrutura - Automação</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    :root {
      --azul-escuro: #232f3e;
      --azul: #0a84ff;
      --azul-claro: #2b6cb0;
      --verde: #18c98c;
      --cinza-claro: #f5f7fb;
      --cinza: #e1e4ea;
      --cinza-escuro: #4b5563;
      --branco: #fff;
      --laranja: #ff9400;
    }
    body {
      font-family: "Segoe UI", "Roboto", Arial, sans-serif;
      background: var(--cinza-claro);
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    h1 {
      color: var(--azul);
      margin-top: 32px;
      font-weight: 800;
      text-align: center;
      letter-spacing: 1px;
      font-size: 2.5rem;
    }
    .menu-bar {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 20px 0 30px 0;
    }
    .menu-bar > button {
      background: var(--azul-escuro);
      color: var(--branco);
      font-size: 1rem;
      border-radius: 8px;
      border: none;
      padding: 12px 30px;
      letter-spacing: 1px;
      transition: background 0.2s;
      font-weight: 500;
      box-shadow: 0 2px 8px #0001;
    }
    .menu-bar > button:hover, .menu-bar > button.active {
      background: var(--azul);
    }
    .section {
      max-width: 1100px;
      margin: 0 auto 40px auto;
      background: var(--branco);
      border-radius: 16px;
      box-shadow: 0 3px 24px #0002;
      border: none;
      padding: 32px 28px;
      position: relative;
      min-height: 120px;
      animation: fadein 0.7s;
    }
    @keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
    .section h2 {
      margin-top: 0;
      color: var(--azul-escuro);
      font-weight: 700;
      letter-spacing: 0.5px;
      font-size: 1.5rem;
    }
    form {
      display: grid;
      gap: 14px;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      margin-bottom: 18px;
      align-items: center;
    }
    form > input, form > select, form > textarea {
      border-radius: 7px;
      border: 1px solid var(--cinza);
      font-size: 1rem;
      padding: 8px 12px;
      background: var(--cinza-claro);
      outline: none;
      transition: border 0.2s;
    }
    form > input:focus, form > select:focus, form > textarea:focus {
      border: 1.5px solid var(--azul);
    }
    form > button {
      grid-column: 1/-1;
      margin: 0 auto;
      margin-top: 8px;
      background: var(--azul);
      color: var(--branco);
      font-weight: 600;
      border-radius: 8px;
      padding: 12px 38px;
      box-shadow: 0 2px 8px #0002;
      transition: background 0.2s;
    }
    form > button:hover {
      background: var(--laranja);
      color: var(--branco);
    }
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: var(--branco);
      box-shadow: 0 1px 8px #0001;
      font-size: 1rem;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 14px;
    }
    th {
      background: var(--azul-escuro);
      color: var(--branco);
      font-weight: 600;
      border: 0;
      padding: 12px 10px;
      text-align: left;
      font-size: 1.08rem;
      letter-spacing: 0.5px;
    }
    td {
      border-bottom: 1px solid var(--cinza);
      background: var(--branco);
      padding: 12px 10px;
      vertical-align: middle;
    }
    tr:last-child td { border-bottom: 0; }
    .hidden { display: none !important; }
    .done { background-color: #eafff1 !important; }
    .filter-bar {
      background: #f9fafb;
      padding: 18px 20px;
      border-radius: 8px;
      margin: 0 0 18px 0;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
      font-size: 1rem;
    }
    .filter-bar label {
      margin-right: 6px;
      color: #555;
      font-weight: 500;
    }
    .filter-bar select, .filter-bar input[type="date"] {
      background: var(--cinza-claro);
      border: 1px solid var(--cinza);
      border-radius: 5px;
      padding: 4px 7px;
      font-size: 1rem;
    }
    .filter-bar button {
      background: var(--laranja);
      color: var(--branco);
      border-radius: 6px;
      padding: 6px 20px;
      font-size: 1rem;
      border: none;
      cursor: pointer;
      margin-left: 7px;
      font-weight: bold;
      box-shadow: 0 1px 6px #0001;
    }
    .expand-btn {
      font-size: 24px;
      font-weight: bold;
      background: none;
      border: none;
      cursor: pointer;
      color: var(--azul);
      transition: color 0.2s;
      border-radius: 4px;
      width: 30px; height: 30px;
      text-align: center;
    }
    .expand-btn:hover { color: var(--laranja); background: #f7f7f7; }
    .action-btn {
      background: var(--azul-claro);
      color: var(--branco);
      border: none;
      padding: 10px 15px;
      margin: 0 2px;
      font-size: 18px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
      vertical-align: middle;
      box-shadow: 0 2px 8px #0001;
      display: inline-block;
    }
    .action-btn:hover { background: var(--laranja); }
    .action-btn.complete { background: var(--verde); color: #fff; }
    .action-btn.complete:disabled { background: #b3e7d4; color: #fff; cursor: not-allowed; }
    .action-btn.edit { background: var(--azul-claro); }
    .action-btn.delete { background: var(--azul-escuro); }
    .checklist-row {
      background: #f5f7fb !important;
    }
    .checklist-expand-cell {
      padding: 24px 0 24px 58px !important;
      border: none;
    }
    .checklist-list {
      margin: 0;
      padding: 0;
      width: 100%;
    }
    .checklist-list li {
      display: flex;
      align-items: center;
      gap: 32px;
      margin: 14px 0;
      font-weight: 600;
      font-size: 1.08rem;
      color: #232f3e;
      list-style: none;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 1px 4px #0001;
      padding: 8px 18px 8px 10px;
      transition: background 0.18s;
      border-left: 5px solid var(--azul-escuro);
    }
    .checklist-list input[type="checkbox"] {
      width: 22px;
      height: 22px;
      margin: 0;
      accent-color: var(--azul);
      flex-shrink: 0;
      border-radius: 5px;
      box-shadow: 0 1px 2px #0002;
      outline: none;
      transition: accent-color 0.2s;
    }
    .checklist-list input[type="checkbox"]:focus {
      outline: 2px solid var(--laranja);
    }
    .select-task-checkbox {
      accent-color: var(--laranja);
      width: 22px;
      height: 22px;
      margin-right: 0;
      margin-left: 7px;
      vertical-align: middle;
      cursor: pointer;
    }
    .pdf-export-bar {
      margin-bottom: 18px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }
    .pdf-export-bar button {
      background: var(--azul-escuro);
      color: #fff;
      border: none;
      padding: 10px 24px;
      font-size: 1rem;
      border-radius: 8px;
      font-weight: 600;
      box-shadow: 0 1px 7px #0001;
      cursor: pointer;
      transition: background 0.18s;
    }
    .pdf-export-bar button:hover {
      background: var(--laranja);
      color: #fff;
    }
    .pdf-export-bar label {
      font-weight: 600;
      color: #444;
      margin-right: 7px;
    }
    @media (max-width: 900px) {
      .section { padding: 14px 3vw; border-radius: 10px; }
      form { grid-template-columns: 1fr; }
      th, td { font-size: 0.97rem; }
      .checklist-row .checklist-expand-cell { padding: 9px 0 9px 17px !important; }
      .checklist-list li { font-size: 0.96rem; gap: 12px; padding: 8px 7px 8px 6px; }
    }
    /* PDF ONLY */
    .pdf-header {
      width:100%;
      display:flex;
      align-items:center;
      gap:18px;
      border-bottom:2px solid #e1e4ea;
      margin-bottom:12px;
      padding-bottom:8px;
      margin-top:8px;
    }
    .pdf-header img {
      height: 50px;
    }
    .pdf-header .empresa {
      font-size: 1.3rem;
      color: #2b6cb0;
      font-weight: 700;
      letter-spacing: 1.5px;
    }
    .pdf-header .data {
      margin-left: auto;
      color: #888;
      font-size: 1.05rem;
      font-weight: 400;
    }
    .pdf-tarefa-detalhe {
      padding: 22px 26px 18px 26px;
      border-radius: 18px;
      background: #fafdff;
      margin-bottom: 30px;
      box-shadow: 0 5px 18px #0001;
      border: 2px solid #e1e4ea;
      page-break-before: always;
    }
    .pdf-tarefa-detalhe h3 {
      margin-top: 0;
      color: #0a84ff;
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 4px;
    }
    .pdf-tarefa-detalhe .pdf-info {
      color: #444;
      font-size: 1.08rem;
      margin-bottom: 8px;
    }
    .pdf-tarefa-detalhe .pdf-status {
      font-weight: bold;
      color: #fff;
      display: inline-block;
      padding: 4px 16px;
      border-radius: 8px;
      margin-bottom: 10px;
      margin-top: 4px;
      font-size: 1.06rem;
      background: #18c98c;
    }
    .pdf-tarefa-detalhe .pdf-status.pendente {
      background: #ff9400;
    }
    .pdf-tarefa-detalhe ul {
      padding-left: 20px;
      margin-top: 7px;
      margin-bottom: 10px;
    }
    .pdf-tarefa-detalhe li {
      margin-bottom: 5px;
      font-size: 1.05rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .pdf-tarefa-detalhe .pdf-item-ok { color: #18c98c; font-size: 1.18em; }
    .pdf-tarefa-detalhe .pdf-item-nok { color: #bbb; font-size: 1.13em; }
    .pdf-tarefa-detalhe .pdf-checklist-title { font-weight: 700; margin-bottom: 2px; color: #232f3e;}
    .pdf-rodape {
      border-top: 1px solid #e1e4ea;
      margin-top: 18px;
      padding-top: 6px;
      color: #888;
      font-size: 0.98rem;
      text-align:right;
    }
    .pdf-signature {
      margin-top: 38px;
      font-size: 1.06rem;
      color: #232f3e;
      text-align:left;
    }
    .pdf-signature .linha {
      border-bottom: 1px solid #bbb;
      width: 240px;
      margin-top: 24px;
    }
  </style>
</head>
<body>
  <h1>Gestão de Infraestrutura <span style="font-size:1.2rem;font-weight:400;color:#888;">| Automação</span></h1>
  <div class="menu-bar">
    <button onclick="mostrarSecao('clientes')">Clientes</button>
    <button onclick="mostrarSecao('tecnicos')">Técnicos</button>
    <button onclick="mostrarSecao('tipos')">Tipos de Tarefa</button>
    <button onclick="mostrarSecao('tarefas')">Tarefas</button>
  </div>
    <!-- CLIENTES -->
  <div id="secao-clientes" class="section hidden">
    <h2>Clientes</h2>
    <button onclick="mostrarSecao('menu')">Menu</button>
    <form id="clienteForm">
      <input type="text" id="razaoSocial" placeholder="Razão Social" required>
      <input type="text" id="cnpj" placeholder="CNPJ" required>
      <input type="text" id="telefone" placeholder="Telefone" required>
      <input type="email" id="email" placeholder="E-mail" required>
      <button type="submit">Adicionar Cliente</button>
    </form>
    <table id="tabelaClientes">
      <thead>
        <tr>
          <th>Razão Social</th><th>CNPJ</th><th>Telefone</th><th>Email</th><th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- TÉCNICOS -->
  <div id="secao-tecnicos" class="section hidden">
    <h2>Técnicos</h2>
    <button onclick="mostrarSecao('menu')">Menu</button>
    <form id="tecnicoForm">
      <input type="text" id="nomeTecnico" placeholder="Nome" required>
      <input type="text" id="funcaoTecnico" placeholder="Função" required>
      <input type="text" id="telefoneTecnico" placeholder="Telefone" required>
      <input type="email" id="emailTecnico" placeholder="E-mail" required>
      <button type="submit">Adicionar Técnico</button>
    </form>
    <table id="tabelaTecnicos">
      <thead>
        <tr>
          <th>Nome</th><th>Função</th><th>Telefone</th><th>Email</th><th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- TIPOS DE TAREFA -->
  <div id="secao-tipos" class="section hidden">
    <h2>Tipos de Tarefa</h2>
    <button onclick="mostrarSecao('menu')">Menu</button>
    <form id="tipoForm">
      <input type="text" id="nomeTipo" placeholder="Nome do Tipo" required>
      <textarea id="checklistTipo" placeholder="Checklist, um por linha"></textarea>
      <button type="submit">Adicionar Tipo</button>
    </form>
    <table id="tabelaTipos">
      <thead>
        <tr>
          <th>Tipo</th><th>Checklist</th><th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- TAREFAS -->
  <div id="secao-tarefas" class="section hidden">
    <h2>Tarefas</h2>
    <button onclick="mostrarSecao('menu')">Menu</button>
    <form id="tarefaForm">
      <input type="text" id="tituloTarefa" placeholder="Título da Tarefa" required>
      <select id="clienteTarefa" required>
        <option value="">Selecione o Cliente</option>
      </select>
      <select id="tecnicoTarefa" required>
        <option value="">Selecione o Técnico</option>
      </select>
      <select id="tipoTarefa" required onchange="renderPreviewChecklist()">
        <option value="">Selecione o Tipo de Tarefa</option>
      </select>
      <input type="date" id="dataTarefa" required>
      <div id="preview-checklist" class="hidden">
        <b>Checklist:</b>
        <ul id="previewChecklistList"></ul>
      </div>
      <button type="submit">Adicionar Tarefa</button>
    </form>

    <div class="filter-bar">
      <label>Cliente:</label>
      <select id="filtroCliente" onchange="renderTarefas()"><option value="">Todos</option></select>
      <label>Técnico:</label>
      <select id="filtroTecnico" onchange="renderTarefas()"><option value="">Todos</option></select>
      <label>Tipo:</label>
      <select id="filtroTipo" onchange="renderTarefas()"><option value="">Todos</option></select>
      <label>Status:</label>
      <select id="filtroStatus" onchange="renderTarefas()"><option value="">Todos</option><option value="pendente">Pendente</option><option value="concluida">Concluída</option></select>
      <label>Data:</label>
      <input type="date" id="filtroData" onchange="renderTarefas()">
      <button onclick="limparFiltros();return false;">Limpar Filtros</button>
    </div>
    <div class="pdf-export-bar">
      <label>Selecionar:</label>
      <button onclick="selecionarTodasTarefas();return false;"><i class="fa fa-list-check"></i> Todas</button>
      <button onclick="desselecionarTodasTarefas();return false;"><i class="fa fa-ban"></i> Nenhuma</button>
      <span style="flex:1"></span>
      <button onclick="exportarTarefasPDFSelecionadas('sintetico')"><i class="fa fa-file-pdf"></i> PDF Sintético</button>
      <button onclick="exportarTarefasPDFSelecionadas('detalhado')"><i class="fa fa-file-contract"></i> PDF Detalhado</button>
    </div>
    <button onclick="exportarJSON()">Exportar JSON</button>
    <input type="file" id="importarJSONinput" style="display:none" accept=".json" onchange="importarJSON(this)">
    <button onclick="document.getElementById('importarJSONinput').click()">Importar JSON</button>
    <div id="tarefasContainer">
      <table id="tabelaTarefas">
        <thead>
          <tr>
            <th style="width:40px"></th>
            <th style="width:32px"></th>
            <th>Título</th>
            <th>Cliente</th>
            <th>Técnico</th>
            <th>Tipo</th>
            <th>Data</th>
            <th>Status</th>
            <th style="width:132px">Ações</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div id="pdfArea" style="display:none"></div>
  </div>
  <script>
// Substitua esta linha pela URL ou Data URI da sua logo se necessário
const LOGO_TECNOEXPRESS = "https://oaidalleapiprodscus.blob.core.windows.net/private/org-xc3nQCYm3YbVfPMoQm1IJBtN/user-0uH6s6b7jzGfWm2lZ9l7Cw6v/img-5cGDiV7oXn6eVh8j3mgRLhnl.png?st=2023-09-02T23%3A52%3A16Z&se=2123-09-02T23%3A52%3A16Z&sp=r&sv=2021-08-06&sr=b&rscd=inline&rsct=image&skoid=7a1775f3-68ba-49b7-9b53-0f02f54cba63&sktid=7b1d0c9d-77b6-45b2-9e6e-4a34d3d7ed19&skt=2023-09-02T23%3A52%3A16Z&ske=2123-09-02T23%3A52%3A16Z&sks=b&skv=2021-08-06&sig=N%2Fz7bP1Gq1R%2B7mq3pBv2hZKhZQbDTSu5vJfD5KpQb3c%3D";

// Todas as variáveis e funções CRUD (clientes, tecnicos, tiposDeTarefa, tarefas) iguais às versões anteriores
// ... (código CRUD igual ao que já enviei nas partes anteriores) ...

// PDF exportação (com logo, cabeçalho e rodapé)
function exportarTarefasPDFSelecionadas(tipo='detalhado') {
  if(tarefasSelecionadas.length===0) {
    alert("Selecione pelo menos uma tarefa para exportar!");
    return;
  }
  let area = document.getElementById('pdfArea');
  let dataEmissao = new Date().toLocaleString();
  let tituloRel = `Relatório de Tarefas ${tipo==='detalhado'?'(Detalhado)':'(Sintético)'}`;
  let html = '';
  // Cabeçalho para cada página
  function getCabecalho() {
    return `
    <div class="pdf-header">
      <img src="${LOGO_TECNOEXPRESS}" style="height:46px;">
      <span class="empresa">Tecnoexpress</span>
      <span style="font-size:1.1rem; font-weight:600; margin-left:16px;">${tituloRel}</span>
      <span class="data">Emitido em: ${dataEmissao}</span>
    </div>`;
  }
  // Rodapé simples com espaço para assinatura
  function getRodape() {
    return `
      <div class="pdf-rodape">
        Relatório gerado automaticamente pelo sistema Tecnoexpress.
        <div class="pdf-signature">
          <div class="linha"></div>
          <div>Assinatura</div>
        </div>
      </div>
    `;
  }
  // Modo sintético: tabela
  if (tipo === 'sintetico') {
    html += getCabecalho();
    html += `<table style="width:100%;border-collapse:collapse;margin-bottom:20px;font-size:1.04rem;">
      <thead>
        <tr>
          <th style="background:#232f3e;color:#fff;padding:9px 6px;">Título</th>
          <th style="background:#232f3e;color:#fff;padding:9px 6px;">Cliente</th>
          <th style="background:#232f3e;color:#fff;padding:9px 6px;">Técnico</th>
          <th style="background:#232f3e;color:#fff;padding:9px 6px;">Tipo</th>
          <th style="background:#232f3e;color:#fff;padding:9px 6px;">Data</th>
          <th style="background:#232f3e;color:#fff;padding:9px 6px;">Status</th>
        </tr>
      </thead>
      <tbody>`;
    tarefasSelecionadas.forEach(idx=>{
      let t = tarefas[idx];
      if(!t) return;
      html += `<tr>
        <td style="padding:7px 6px;">${t.titulo||''}</td>
        <td style="padding:7px 6px;">${t.cliente||''}</td>
        <td style="padding:7px 6px;">${t.tecnico||''}</td>
        <td style="padding:7px 6px;">${t.tipo||''}</td>
        <td style="padding:7px 6px;">${t.data||''}</td>
        <td style="padding:7px 6px;font-weight:bold;color:${t.status==='concluida'?'#18c98c':'#ff9400'}">${t.status==='concluida'?'Executada':'Pendente'}</td>
      </tr>`;
    });
    html += `</tbody></table>`;
    html += getRodape();
  } else {
    tarefasSelecionadas.forEach((idx, n)=>{
      let t = tarefas[idx];
      if(!t) return;
      html += `<div class="pdf-tarefa-detalhe"${n>0?' style="page-break-before:always;"':''}>`;
      html += getCabecalho();
      html += `
        <h3>${t.titulo||''}</h3>
        <div class="pdf-info"><b>Cliente:</b> ${t.cliente||''}</div>
        <div class="pdf-info"><b>Técnico:</b> ${t.tecnico||''}</div>
        <div class="pdf-info"><b>Tipo:</b> ${t.tipo||''}</div>
        <div class="pdf-info"><b>Data:</b> ${t.data||''}</div>
        <div class="pdf-status${t.status!=='concluida'?' pendente':''}">${t.status==='concluida'?'Executada':'Pendente'}</div>
        <div class="pdf-checklist-title">Checklist:</div>
        <ul>`;
      (t.checklist||[]).forEach(item=>{
        html += `<li>
          <span class="${item.feito?'pdf-item-ok':'pdf-item-nok'}">${item.feito?'&#10003;':'&#9633;'}</span>
          <span style="${item.feito?'color:#18c98c;':'color:#232f3e;'}">${item.texto||''}</span>
        </li>`;
      });
      html += `</ul>`;
      html += getRodape();
      html += `</div>`;
    });
  }
  area.innerHTML = html;
  area.style.display = "block";
  setTimeout(()=>{
    html2pdf().set({
      margin: 0.5,
      filename: `relatorio_tarefas_${tipo}_${new Date().toISOString().slice(0,10)}.pdf`,
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
    }).from(area).save().then(()=>{area.style.display="none";});
  }, 400);
}

// ... (demais funções CRUD, filtro, seleção, importação/exportação JSON, renderização, navegação entre seções, iguais ao que já enviei) ...

// NAVEGAÇÃO E INICIALIZAÇÃO
function mostrarSecao(secao) {
  document.querySelectorAll('.section').forEach(div => div.classList.add('hidden'));
  if(secao==='menu') return;
  document.getElementById(`secao-${secao}`).classList.remove('hidden');
}
window.onload = function() {
  carregarClientes?.(); renderClientes?.();
  carregarTecnicos?.(); renderTecnicos?.();
  carregarTipos?.(); renderTipos?.();
  carregarTarefas?.(); renderTarefas?.();
  atualizarSelects?.();
  mostrarSecao('menu');
};
</script>
</body>
</html>
